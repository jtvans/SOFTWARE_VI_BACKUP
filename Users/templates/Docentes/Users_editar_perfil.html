<!-- Users_editar_perfil.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Breadcrumb -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="{% static 'css/USERS/Breadcrumbs/style.css' %}">

    <link rel="stylesheet" href="{% static 'css/USERS/Users_Perfil_Editar/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.png' %}">
    <title>SeedResearchTool</title>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <a class="navbar-brand" href="{% url 'Users:Users_home' %}">
                <img src="{% static 'images/USERS/Users_Login/Login_Logo.png' %}" alt="" style="width: 240px; height: 60px;">
            </a>
        </div>
        <ul class="navbar-menu">
            {% if user.is_authenticated and not user.usuario_administrador %}
            <li class="navbar-item">
                <a class="nav-link" href="{% url 'Users:Users_home' %}">HOME</a>
            </li>
            <li class="navbar-item dropdown">
                <a class="nav-link" href="#">PROYECTOS</a>
                <div class="dropdown-content">
                    <a class="text-center" href="{% url 'Proyectos:crear_proyecto' %}">Crear Proyecto</a>
                    <a class="text-center" href="{% url 'Proyectos:lista_proyectos' %}">Lista de Proyectos</a>
                </div>
            </li>
            <li class="navbar-item dropdown">
                <a class="nav-link" href="#">SEMILLEROS</a>
                <div class="dropdown-content">
                    <a class="text-center" href="{% url 'Semilleros:crear_semillero' %}">Crear Semillero</a>
                    <a class="text-center" href="{% url 'Semilleros:lista_semilleros' %}">Lista de Semilleros</a>
                </div>
            </li>
            {% endif %}
        </ul>

        <ul class="navbar-menu ml-auto">
            {% if user.is_authenticated and not user.usuario_administrador %}
            <li class="navbar-item dropdown">
                <a class="nav-link" href="#">GRUPOS INVESTIGACION</a>
                <div class="dropdown-content">
                    <a class="text-center" href="{% url 'Users:Users_ver_grupos' %}">Ver Grupos</a>
                    <a class="text-center" href="{% url 'Users:Users_editar_grupos_investigacion' %}">Editar Grupos</a>
                </div>
            </li>
            <li class="navbar-item dropdown">
                <a class="nav-link" href="#">PERFIL</a>
                <div class="dropdown-content">
                    <a class="text-center" href="{% url 'Users:Users_ver_perfil' %}">Ver Perfil</a>
                    <a class="text-center" href="{% url 'Users:Users_editar_perfil' %}">Editar Perfil</a>
                </div>
            </li>
            <li class="navbar-item ajuste-izquierda">                
                <a class="nav-link fa" style="font-size:26px" href="{% url 'Users:logout' %}">&#xf011;</a>
            </li>
            {% else %}
            <li class="navbar-item">
                <a class="nav-link" href="{% url 'Users:Users_login' %}">INICIAR SESION</a>
            </li>
            <li class="navbar-item">
                <a class="nav-link"
                    href="{% url 'Users:Users_consultar_identificacion' %}">REGISTRARSE</a>
            </li>
            {% endif %}
        </ul>
    </nav>

 
    <!-- Breadcrumb -->
    <div class="wrapper">
        <ol class="breadcrumbs breadcrumbs--one" itemscope itemtype="http://schema.org/BreadcrumbList">
          <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a class="breadcrumb" href="{% url 'Users:Users_home' %}" itemprop="item">
              <span itemprop="name">
                <i class="material-icons" aria-hidden="true">home</i>
                <span>INICIO</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </li>

          <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a class="breadcrumb" href="{% url 'Users:Users_ver_perfil' %}" itemprop="item">
              <span itemprop="name">
                <i class="material-icons" aria-hidden="true">person</i>
                <span>PERFIL</span>
               </span>
            </a>
            <meta itemprop="position" content="2" />
          </li>

          <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a class="breadcrumb" href="{% url 'Users:Users_editar_perfil' %}" itemprop="item">
              <span itemprop="name">
                <i class="material-icons" aria-hidden="true">settings</i>
                <span>EDITAR PERFIL</span>
               </span>
            </a>
            <meta itemprop="position" content="2" />
          </li>
        </ol>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <br>
        <br>
        <br>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><strong>Editar Perfil</strong></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <strong>¿ Confirmar Datos ?</strong>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="guardarCambiosBtn" >Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid content-container">
        <br>
        <br>
        <br>
        <br>
        <br>

        <!-- Message -->
        <div class="messages-container">
            {% for message in messages %}
                <div class="error-message">
                    {{ message }}
                </div>
            {% endfor %}
        </div>

        <div class="text-center">
            <h1>EDITAR PERFIL</h1>
        </div>     
       
        <br>
        <div class="container-e">
            <div class="container-e-1">
                <form method="POST" action="{% url 'Users:Users_editar_perfil' %}" id="editarPerfilForm">
                    {% csrf_token %}  
                        <div class="form-group">
                            <label for="telefono">Teléfono *</label>
                            <input type="text" class="form-control" name="telefono" value="{{ usuario.telefono }}" required>
                        </div>

                        <div class="form-group">
                            <label for="cvlac">Cvlac</label>
                            <input type="text" class="form-control" name="cvlac" value="{{ usuario.cvlac }}">
                        </div>

                        <div class="form-group">
                            <label for="orcid">Orcid</label>
                            <input type="text" class="form-control" name="orcid" value="{{ usuario.orcid }}">
                        </div>

                        <div class="form-group">
                            <label for="google_scholar">Google Scholar</label>
                            <input type="text" class="form-control" name="google_scholar" value="{{ usuario.google_scholar }}">
                        </div><br>

                        <div class="form-group">
                            <label for="categoria">Categoría *</label>
                            <select class="form-control" name="categoria">
                                <option value="Junior" {% if usuario.categoria == 'Junior' %}selected{% endif %}>Junior</option>
                                <option value="Asociado" {% if usuario.categoria == 'Asociado' %}selected{% endif %}>Asociado</option>
                                <option value="Emerito" {% if usuario.categoria == 'Emerito' %}selected{% endif %}>Emerito</option>
                                <option value="No_Reconocido" {% if usuario.categoria == 'No_Reconocido' %}selected{% endif %}>No Reconocido</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="facultad">Facultad *</label>
                            <select class="form-control" name="facultad" id="facultad">
                                <option value="Humanidades" {% if usuario.facultad == 'Humanidades' %}selected{% endif %}>HUMANIDADES Y CIENCIAS SOCIALES</option>
                                <option value="Ciencias_Admin" {% if usuario.facultad == 'Ciencias_Admin' %}selected{% endif %}>CIENCIAS ADMINISTRATIVAS, ECONOMICAS Y CONTABLES</option>
                                <option value="Ingenieria" {% if usuario.facultad == 'Ingenieria' %}selected{% endif %}>INGENIERIA</option>
                                <option value="Educacion" {% if usuario.facultad == 'Educacion' %}selected{% endif %}>EDUCACION</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="Programa">Programa *</label>
                            <select class="form-control" name="Programa" id="Programa"></select>
                        </div>
                        <br>

                        <div class="container-fluid">
                            <div class="row d-flex justify-content-center">
                                <div class="col-md-6 text-center">
                                    <a href="{% url 'Users:Users_ver_perfil' %}" class="btn btn-secondary">Cancelar</a>
                                    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal">Guardar Cambios</button>
                                </div>
                            </div>
                        </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- SCRIPT - Modal Confirmacion -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const guardarCambiosBtn = document.getElementById("guardarCambiosBtn");
            const editarPerfilForm = document.getElementById("editarPerfilForm");
    
            guardarCambiosBtn.addEventListener("click", function () {
                // Forzar la validación del formulario antes de enviarlo
                if (editarPerfilForm.reportValidity()) {
                    const formData = new FormData(editarPerfilForm);
    
                    fetch("{% url 'Users:Users_editar_perfil' %}", {
                        method: "POST",
                        body: formData
                    })
                    .then(data => {
                        console.log(data);
    
                        // Cerrar el modal
                        const modal = new bootstrap.Modal(document.getElementById("exampleModal"));
                        modal.hide();
    
                        // Redirigir después de cerrar el modal
                        window.location.href = "{% url 'Users:Users_ver_perfil' %}";
                    })
                    .catch(error => {
                        console.error("Error al enviar los datos:", error);
                    });
                }
            });
        });
    </script>
    
    
    <!-- SCRIPT - Facultad-Programa -->
    <script>
        // FACULTAD PROGRAMA
        const facultadSelect = document.getElementById('facultad');
        const ProgramaSelect = document.getElementById('Programa');

        // FACULTAD PROGRAMA
        const opcionesPrograma = {
            Humanidades: [
                { value: 'Derecho', label: 'Derecho' },
                { value: 'Psicologia', label: 'Psicologia' },
                { value: 'Comunicacion Social', label: 'Comunicacion Social' },
                { value: 'Tecnología en Higiene y Seguridad en el Trabajo', label: 'Tecnología en Higiene y Seguridad en el Trabajo' }
            ],
            Ciencias_Admin: [
                { value: 'Administración de Empresas - Modalidad Presencial', label: 'Administración de Empresas - Modalidad Presencial' },
                { value: 'Administración de Empresas - Modalidad Virtual', label: 'Administración de Empresas - Modalidad Virtual' },
                { value: 'Administración Turística y Hotelera', label: 'Administración Turística y Hotelera' },
                { value: 'Contaduría Pública - Modalidad Presencial', label: 'Contaduría Pública - Modalidad Presencial' },
                { value: 'Contaduría Pública - Modalidad Virtual', label: 'Contaduría Pública - Modalidad Virtual' },
                { value: 'Negocios Internacionales - Modalidad Presencial', label: 'Negocios Internacionales - Modalidad Presencial' },
                { value: 'Negocios Internacionales - Modalidad Virtual', label: 'Negocios Internacionales - Modalidad Virtual' }
            ],
            Ingenieria: [
                { value: 'Ingeniería de Sistemas', label: 'Ingeniería de Sistemas' },
                { value: 'Ingeniería Industrial - Modalidad Presencial', label: 'Ingeniería Industrial - Modalidad Presencial' },
                { value: 'Ingeniería Industrial - Modalidad Virtual', label: 'Ingeniería Industrial - Modalidad Virtual' }
            ],
            Educacion: [
                { value: 'Licenciatura en Educación Bilingüe', label: 'Licenciatura en Educación Bilingüe' },
                { value: 'Licenciatura en Educación Infantil', label: 'Licenciatura en Educación Infantil' }
            ]
        };

        function cargarOpcionesPrograma() {
            const facultadSeleccionado = facultadSelect.value;
            const Programas = opcionesPrograma[facultadSeleccionado];

            // Limpiar las opciones anteriores
            ProgramaSelect.innerHTML = '';

            // Crear y agregar las nuevas opciones
            Programas.forEach(opcion => {
                const optionPrograma = document.createElement('option');
                optionPrograma.value = opcion.value;
                optionPrograma.textContent = opcion.label;
                ProgramaSelect.appendChild(optionPrograma);
            });
        };

        cargarOpcionesPrograma();
        facultadSelect.addEventListener('change', cargarOpcionesPrograma);
    </script>
    
</body>

    
</html>